aduc_folder = 7060Libs
asm_files = $(shell find -name *.s)

obj-$(CONFIG_ADUC706X_ADILIB) += $(aduc_folder)/
inc-$(CONFIG_ADUC706X_ADILIB) += $(aduc_folder)/
icf-y += aduc706x.icf

autogen:
	@echo "note: please double click clear.bat before excute me"
	@echo "# Autogenerated by make, please do not edit me manually" > $(aduc_folder)/Makefile
	@date "+# date: %Y/%m/%d %H:%M:%S" >> $(aduc_folder)/Makefile
	@echo "" >> $(aduc_folder)/Makefile
	@find -name *.s >> $(aduc_folder)/Makefile
	@sed -i 's/\.\/$(aduc_folder)\//obj-y += /' $(aduc_folder)/Makefile
	@sed -i 's/\.s/\.o/' $(aduc_folder)/Makefile

	@rm -rf $(aduc_folder)/aduc706x.h
	@echo "/* Autogenerated by make, please do not edit me manually" > $(aduc_folder)/aduc706x.tmp
	@date "+   date: %Y/%m/%d %H:%M:%S" >> $(aduc_folder)/aduc706x.tmp
	@echo "*/" >> $(aduc_folder)/aduc706x.tmp
	@echo "#ifndef __ADUC706X_H_" >> $(aduc_folder)/aduc706x.tmp
	@echo "#define __ADUC706X_H_" >> $(aduc_folder)/aduc706x.tmp
	@echo "" >> $(aduc_folder)/aduc706x.tmp
	@find -name *.h >> $(aduc_folder)/aduc706x.tmp
	@sed -i 's/\.\/$(aduc_folder)\//#include "/' $(aduc_folder)/aduc706x.tmp
	@sed -i 's/\.h/\.h"/' $(aduc_folder)/aduc706x.tmp
	@echo "" >> $(aduc_folder)/aduc706x.tmp
	@echo "#endif /*__ADUC706X_H_*/" >> $(aduc_folder)/aduc706x.tmp
	@mv $(aduc_folder)/aduc706x.tmp $(aduc_folder)/aduc706x.h
	#fix .s include path bug && Module related bug in UrtMod.s
	@-for file in $(shell find -name *.s); do \
		echo $$file; \
		sed -i '/ADuC7060.inc/c\#include "../ADuC7060.inc"' $$file; \
		sed -i '/MODULE/d' $$file; \
		sed -i '/ENDMOD/d' $$file; \
		sed -i '/RSEG CODE/c\		SECTION .text:CODE:NOROOT(2)' $$file; \
	done
	
	